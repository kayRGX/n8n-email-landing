<!DOCTYPE html>
<html>
<head>
  <title>處理中...</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; text-align: center; background-color: #f5f5f5; }
    .container { background-color: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    h1 { color: #333; }
    p { color: #666; }
  </style>
</head>
<body>
  <div class="container">
    <h1 id="status-message">請求已收到，正在處理中...</h1>
    <p>您可以安全地關閉此頁面了。</p>
  </div>

  <script>
    // 這裡設定 n8n webhook URL
    const YES_WEBHOOK_URL = "https://rgx-kay.app.n8n.cloud/webhook/27bc3de4-92a4-46ca-9ed0-e84c0a4ec6e3";
    const NO_WEBHOOK_URL = "https://rgx-kay.app.n8n.cloud/webhook/YOUR_REAL_NO_WEBHOOK_URL_HERE"; //待填

    window.onload = function() {
      const params = new URLSearchParams(window.location.search);
      const decision = params.get('decision');
      const recordId = params.get('recordId');
      const email = params.get('email');

      if (!decision || !recordId || !email) {
        document.getElementById('status-message').innerText = '缺少必要參數。';
        return;
      }

      let targetWebhookUrl = "";
      if (decision === 'yes') {
        targetWebhookUrl = YES_WEBHOOK_URL;
      } else if (decision === 'no') {
        targetWebhookUrl = NO_WEBHOOK_URL;
      } else {
        document.getElementById('status-message').innerText = '決策參數錯誤。';
        return;
      }

      // 拼接 redirect URL
      const redirectUrl = `${targetWebhookUrl}?recordId=${encodeURIComponent(recordId)}&email=${encodeURIComponent(email)}&decision=${encodeURIComponent(decision)}`;

      // 立即 redirect 到 workflow2
      window.location.href = redirectUrl;
    };
  </script>
</body>
</html>
